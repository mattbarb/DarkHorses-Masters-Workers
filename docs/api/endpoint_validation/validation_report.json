{
  "timestamp": "2025-10-08T10:03:03.413574",
  "summary": {
    "total": 3,
    "passed": 2,
    "failed": 1
  },
  "endpoint_status": {
    "/v1/horses/{id}/pro": "FAILED",
    "/v1/racecards/pro": "CONFIRMED",
    "/v1/results": "CONFIRMED"
  },
  "detailed_results": [
    {
      "test": "test_horses_pro_endpoint.py",
      "description": "Horse Pro Endpoint - Pedigree Data",
      "success": false,
      "exit_code": 1,
      "output": "================================================================================\nTESTING: GET /v1/horses/{id}/pro\n================================================================================\n\nStep 1: Getting sample horse IDs from /v1/horses/search...\nFAILED: Could not get horses from search endpoint\n",
      "error": "/Users/matthewbarber/Library/Python/3.9/lib/python/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020\n  warnings.warn(\nHTTP 422 for https://api.theracingapi.com/v1/horses/search, attempt 1/5\nHTTP 422 for https://api.theracingapi.com/v1/horses/search, attempt 2/5\nHTTP 422 for https://api.theracingapi.com/v1/horses/search, attempt 3/5\nHTTP 422 for https://api.theracingapi.com/v1/horses/search, attempt 4/5\nHTTP 422 for https://api.theracingapi.com/v1/horses/search, attempt 5/5\nFailed to fetch https://api.theracingapi.com/v1/horses/search after 5 attempts\n"
    },
    {
      "test": "test_racecards_fields.py",
      "description": "Racecards Pro - Available Fields",
      "success": true,
      "exit_code": 0,
      "output": "================================================================================\nTESTING: GET /v1/racecards/pro - Available Fields\n================================================================================\n\nStep 1: Fetching racecards for 2025-10-08...\nFound 38 racecards\n\nStep 2: Analyzing race and runner fields...\n\nRACE-LEVEL FIELDS:\n--------------------------------------------------------------------------------\n  pattern                  : NULL/EMPTY   | \n  sex_restriction          : NULL/EMPTY   | \n  rating_band              : NULL/EMPTY   | \n  jumps                    : NULL/EMPTY   | \n  stalls                   : NULL/EMPTY   | \n  tip                      : PRESENT      | Rapid Force\n  verdict                  : PRESENT      | Mr Writer has the benefit of experience but both n\n  betting_forecast         : PRESENT      | Evs Rapid Force, 15/8 Mr Writer, 100/30 Zooella\n  spotlight                : MISSING      | None\n\nRUNNER-LEVEL FIELDS (from first runner):\n--------------------------------------------------------------------------------\n  spotlight                : PRESENT      | Ran with promise in some useful maiden/novice even\n  quotes                   : NULL/EMPTY   | []\n  stable_tour              : NULL/EMPTY   | []\n  medical                  : NULL/EMPTY   | []\n  odds                     : PRESENT      | [{'bookmaker': 'Bet365', 'fractional': '9/4', 'dec\n  wind_surgery             : NULL/EMPTY   | \n  prev_trainers            : NULL/EMPTY   | []\n  prev_owners              : PRESENT      | [{'owner': 'Justwow', 'owner_id': 'own_1074768', '\n  trainer_location         : PRESENT      | Newmarket, Suffolk\n  trainer_rtf              : PRESENT      | 43\n  dob                      : PRESENT      | 2023-03-11\n  sex_code                 : PRESENT      | G\n  colour                   : PRESENT      | gr\n  region                   : PRESENT      | IRE\n  breeder                  : PRESENT      | Grangemore Stud\n\n================================================================================\nALL AVAILABLE FIELDS IN SAMPLE RACE:\n--------------------------------------------------------------------------------\nRace fields: ['race_id', 'course', 'course_id', 'date', 'off_time', 'off_dt', 'race_name', 'distance_round', 'distance', 'distance_f', 'region', 'pattern', 'sex_restriction', 'race_class', 'type', 'age_band', 'rating_band', 'prize', 'field_size', 'going_detailed', 'rail_movements', 'stalls', 'weather', 'going', 'surface', 'jumps', 'runners', 'big_race', 'is_abandoned', 'tip', 'verdict', 'betting_forecast']\n\nRunner fields: ['horse_id', 'horse', 'dob', 'age', 'sex', 'sex_code', 'colour', 'region', 'breeder', 'dam', 'dam_id', 'dam_region', 'sire', 'sire_id', 'sire_region', 'damsire', 'damsire_id', 'damsire_region', 'trainer', 'trainer_id', 'trainer_location', 'trainer_14_days', 'owner', 'owner_id', 'prev_trainers', 'prev_owners', 'comment', 'spotlight', 'quotes', 'stable_tour', 'medical', 'number', 'draw', 'headgear', 'headgear_run', 'wind_surgery', 'wind_surgery_run', 'past_results_flags', 'lbs', 'ofr', 'rpr', 'ts', 'jockey', 'jockey_id', 'silk_url', 'last_run', 'form', 'trainer_rtf', 'odds']\n\n================================================================================\nSUMMARY\n================================================================================\nTarget race fields with data: 3/9\nTarget runner fields with data: 10/15\n\nFIELDS AVAILABLE BUT NOT CURRENTLY EXTRACTED:\n--------------------------------------------------------------------------------\nRace fields:\n  - tip\n  - verdict\n  - betting_forecast\n\nRunner fields:\n  - spotlight\n  - odds\n  - prev_owners\n  - trainer_location\n  - trainer_rtf\n  - dob\n  - sex_code\n  - colour\n  - region\n  - breeder\n\n================================================================================\nSAMPLE DATA (first race):\n--------------------------------------------------------------------------------\n{\n  \"race_id\": \"rac_11745760\",\n  \"race_name\": \"Unibet Zero% Mission EBF Novice Stakes (GBB Race)\",\n  \"course\": \"Kempton (AW)\",\n  \"available_fields\": {\n    \"race\": [\n      \"tip\",\n      \"verdict\",\n      \"betting_forecast\"\n    ],\n    \"runner\": [\n      \"spotlight\",\n      \"odds\",\n      \"prev_owners\",\n      \"trainer_location\",\n      \"trainer_rtf\",\n      \"dob\",\n      \"sex_code\",\n      \"colour\",\n      \"region\",\n      \"breeder\"\n    ]\n  },\n  \"runner_count\": 3\n}\n\n================================================================================\nRESULT: CONFIRMED - Endpoint accessible\n\nConfirmed 13 additional fields available\n",
      "error": "/Users/matthewbarber/Library/Python/3.9/lib/python/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020\n  warnings.warn(\n"
    },
    {
      "test": "test_results_runners.py",
      "description": "Results Endpoint - Runner Count Analysis",
      "success": true,
      "exit_code": 0,
      "output": "================================================================================\nTESTING: GET /v1/results - Runner Count Analysis\n================================================================================\n\nStep 1: Fetching results from 2025-10-01 to 2025-10-08...\n\n  Fetched 50 results (total: 50)\n  Fetched 50 results (total: 100)\n  Fetched 50 results (total: 150)\n  Fetched 50 results (total: 200)\n\nTotal results fetched: 200\n\nStep 2: Analyzing runner counts per race...\n\n================================================================================\nRUNNER COUNT STATISTICS\n================================================================================\nTotal races analyzed: 200\nTotal runners: 1826\nAverage runners per race: 9.13\nMin runners: 2\nMax runners: 26\n\nRUNNER COUNT DISTRIBUTION:\n--------------------------------------------------------------------------------\n   2 runners:   1 races (  0.5%) \n   3 runners:   3 races (  1.5%) \n   4 runners:   1 races (  0.5%) \n   5 runners:  21 races ( 10.5%) #####\n   6 runners:  25 races ( 12.5%) ######\n   7 runners:  22 races ( 11.0%) #####\n   8 runners:  22 races ( 11.0%) #####\n   9 runners:  24 races ( 12.0%) ######\n  10 runners:  19 races (  9.5%) ####\n  11 runners:  13 races (  6.5%) ###\n  12 runners:  15 races (  7.5%) ###\n  13 runners:  15 races (  7.5%) ###\n  14 runners:   6 races (  3.0%) #\n  15 runners:   8 races (  4.0%) ##\n  17 runners:   1 races (  0.5%) \n  18 runners:   2 races (  1.0%) \n  19 runners:   1 races (  0.5%) \n  26 runners:   1 races (  0.5%) \n\nSAMPLE RACES:\n--------------------------------------------------------------------------------\n  rac_11745682: Arc All-Weather \u00a31Million Bonus Returns Handicap at Southwell (AW)\n    Date: 2025-10-07, Runners: 6\n    Sample runners: Create (IRE), Fire Eyes (FR), King Sharja (GB)\n\n  rac_11745643: Download The At The Races App Handicap at Southwell (AW)\n    Date: 2025-10-07, Runners: 7\n    Sample runners: Little Miss India (IRE), Major Major (IRE), Mr Nugget (GB)\n\n  rac_11745656: attheraces.com/marketmovers Handicap at Southwell (AW)\n    Date: 2025-10-07, Runners: 6\n    Sample runners: Moab (IRE), Universal Story (IRE), Doddington Guy (GB)\n\n  rac_11745669: Download The At The Races App Handicap at Southwell (AW)\n    Date: 2025-10-07, Runners: 12\n    Sample runners: Forest Gunner (IRE), Masterclass (GB), Dorothy May (IRE)\n\n  rac_11745604: Free Bets On attheraces.com Fillies' Handicap at Southwell (AW)\n    Date: 2025-10-07, Runners: 5\n    Sample runners: Sarafina Mshairi (GB), After Love (IRE), Addarella (IRE)\n\n================================================================================\nCOMPARISON WITH AUDIT FINDINGS\n================================================================================\nDatabase (audit):     2.77 avg runners per race\nAPI (this test):      9.13 avg runners per race\nExpected normal:      8-12 runners per race\n\nRESULT: CONFIRMED - API returns full runner data\n\nCONCLUSION: The missing runners issue is likely due to:\n  1. Data extraction logic skipping runners (line 284-286 in races_fetcher.py)\n  2. Database filtering removing runners\n  3. Historical data backfill incomplete\n\n================================================================================\nRECOMMENDATIONS:\n--------------------------------------------------------------------------------\n1. Review races_fetcher.py line 284-286 - may be skipping runners\n2. Check database for runner count vs API\n3. Run backfill for historical data\n\n",
      "error": "/Users/matthewbarber/Library/Python/3.9/lib/python/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020\n  warnings.warn(\n"
    }
  ]
}